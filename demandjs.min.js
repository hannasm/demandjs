/*
 DemandJS - v.0.0.4  MIT License

Copyright (c) 2017 Sean Hanna

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,f,a){d!=Array.prototype&&d!=Object.prototype&&(d[f]=a.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var d=0;return function(f){return $jscomp.SYMBOL_PREFIX+(f||"")+d++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var f=0;return $jscomp.iteratorPrototype(function(){return f<d.length?{done:!1,value:d[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();var f=d[Symbol.iterator];return f?f.call(d):$jscomp.arrayIterator(d)};
$jscomp.polyfill=function(d,f,a,b){if(f){a=$jscomp.global;d=d.split(".");for(b=0;b<d.length-1;b++){var c=d[b];c in a||(a[c]={});a=a[c]}d=d[d.length-1];b=a[d];f=f(b);f!=b&&null!=f&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:f})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function f(){this.batch_=null}function a(a){return a instanceof c?a:new c(function(h,b){h(a)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;f.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};f.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var b=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(a){b(a,
0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var e=a[b];delete a[b];try{e()}catch(k){this.asyncThrow_(k)}}}this.batch_=null};f.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(g){b.reject(g)}};c.prototype.createResolveAndReject_=
function(){function a(a){return function(h){e||(e=!0,a.call(b,h))}}var b=this,e=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(g){this.reject_(g);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var e=new f;c.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};c.prototype.settleSameAsThenable_=function(a,b){var e=this.createResolveAndReject_();try{a.call(b,e.resolve,e.reject)}catch(k){e.reject(k)}};c.prototype.then=function(a,b){function e(a,b){return"function"==typeof a?function(b){try{h(a(b))}catch(u){m(u)}}:b}var h,m,d=new c(function(a,
b){h=a;m=b});this.callWhenSettled_(e(a,h),e(b,m));return d};c.prototype.catch=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,b){function c(){switch(h.state_){case 1:a(h.result_);break;case 2:b(h.result_);break;default:throw Error("Unexpected state: "+h.state_);}}var h=this;null==this.onSettledCallbacks_?e.asyncExecute(c):this.onSettledCallbacks_.push(function(){e.asyncExecute(c)})};c.resolve=a;c.reject=function(a){return new c(function(b,e){e(a)})};c.race=function(b){return new c(function(e,
c){for(var h=$jscomp.makeIterator(b),m=h.next();!m.done;m=h.next())a(m.value).callWhenSettled_(e,c)})};c.all=function(b){var e=$jscomp.makeIterator(b),h=e.next();return h.done?a([]):new c(function(b,c){function m(a){return function(e){d[a]=e;g--;0==g&&b(d)}}var d=[],g=0;do d.push(void 0),g++,a(h.value).callWhenSettled_(m(d.length-1),c),h=e.next();while(!h.done)})};return c},"es6","es3");$jscomp.owns=function(d,f){return Object.prototype.hasOwnProperty.call(d,f)};
$jscomp.polyfill("WeakMap",function(d){function f(a){$jscomp.owns(a,b)||$jscomp.defineProperty(a,b,{value:{}})}function a(a){var b=Object[a];b&&(Object[a]=function(a){f(a);return b(a)})}if(function(){if(!d||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),e=new d([[a,2],[b,3]]);if(2!=e.get(a)||3!=e.get(b))return!1;e.delete(a);e.set(b,4);return!e.has(a)&&4==e.get(b)}catch(k){return!1}}())return d;var b="$jscomp_hidden_"+Math.random().toString().substring(2);a("freeze");a("preventExtensions");
a("seal");var c=0,e=function(a){this.id_=(c+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};e.prototype.set=function(a,e){f(a);if(!$jscomp.owns(a,b))throw Error("WeakMap key fail: "+a);a[b][this.id_]=e;return this};e.prototype.get=function(a){return $jscomp.owns(a,b)?a[b][this.id_]:void 0};e.prototype.has=function(a){return $jscomp.owns(a,b)&&$jscomp.owns(a[b],this.id_)};e.prototype.delete=
function(a){return $jscomp.owns(a,b)&&$jscomp.owns(a[b],this.id_)?delete a[b][this.id_]:!1};return e},"es6","es3");$jscomp.polyfill("Object.assign",function(d){return d?d:function(d,a){for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var e in c)$jscomp.owns(c,e)&&(d[e]=c[e])}return d}},"es6","es3");
var _createClass=function(){function d(d,a){for(var b=0;b<a.length;b++){var c=a[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(d,c.key,c)}}return function(f,a,b){a&&d(f.prototype,a);b&&d(f,b);return f}}();function _classCallCheck(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function");}
(function(d){d=function(){function d(a){var b=this;_classCallCheck(this,d);this.phRegistry=new WeakMap;this.loaded=new WeakMap;var c={};a&&"linkHandler"in a&&(c=a.linkHandler,delete a.linkHandler);this.options=Object.assign({loadingHtml:'<div style="width:100%;height:100%">Loading In Progress</div>',failureHtml:'<div style="background-color:#F00;color:#FFF;font-size:20pt;">ERROR</div>',createLoadingNode:function(a){return b.createLoadingNode()},createFailureNode:function(a,c){return b.createFailureNode()},
shouldRemove:function(a){return!("tagName"in a)||!a.tagName.match(/link/i)},shouldInsertOnLoad:function(a){return b.options.shouldRemove(a)},selector:"img,video,picture,iframe,link.demand",rootMargin:"48px",threshold:0,onLoadBegin:function(a){},onLoadSuccess:function(a){return b.onLoadSuccess(a)},onLoadFailure:function(a,c){return b.onLoadFailure(a,c)},onLoadComplete:function(a){},linkHandler:{"text/html":function(a,c){return b.injectHtml(a,c)},"application/xhtml+xml":function(a,c){return b.injectHtml(a,
c)}}},a);this.options.linkHandler=Object.assign(this.options.linkHandler,c);this.mutation=new MutationObserver(function(a,c){return b.observeMutation(a,c)});this.mutationOptions={childList:!0,subtree:!0};this.intersectionOptions={root:null,rootMargin:this.options.rootMargin,threshold:this.options.threshold};this.intersection=new IntersectionObserver(function(a,c){return b.observeIntersection(a,c)},this.intersectionOptions);this.observeTargets(this.queryTargets());this.mutation.observe(document.body,
this.mutationOptions)}_createClass(d,[{key:"observeMutation",value:function(a){var b=!0,c=!1,e=void 0;try{for(var d=a[Symbol.iterator](),m;!(b=(m=d.next()).done);b=!0){var g=m.value;if("childList"===g.type){a=!0;var f=!1,l=void 0;try{for(var n=g.addedNodes[Symbol.iterator](),p;!(a=(p=n.next()).done);a=!0){var t=p.value;this.isTargetMatch(t)&&this.observeTarget(t)}}catch(q){f=!0,l=q}finally{try{!a&&n.return&&n.return()}finally{if(f)throw l;}}}}}catch(q){c=!0,e=q}finally{try{!b&&d.return&&d.return()}finally{if(c)throw e;
}}}},{key:"observeIntersection",value:function(a){var b=!0,c=!1,e=void 0;try{for(var d=a[Symbol.iterator](),m;!(b=(m=d.next()).done);b=!0){var g=m.value;if(g.isIntersecting){var f=this.phRegistry.get(g.target);void 0===f||f.loading||(f.loading=!0,this.beginLoad(f))}}}catch(l){c=!0,e=l}finally{try{!b&&d.return&&d.return()}finally{if(c)throw e;}}}},{key:"beginLoad",value:function(a){var b=this,c=this.resolveTarget(a);a=c.target;var e=c.registration;if(e.extraData.shouldInjectLink){var d=e.extraData.href;
this.options.onLoadBegin(a);fetch(d).then(function(a){if(!a.ok){var b=Error('Fetching "'+d+'" failed with '+a.status+" "+a.statusText);b.responseDetail=a;throw b;}return a.text()}).then(function(a){b.injectLink(e,a)}).catch(function(a){b.handleError(e,a)})}else if(e.extraData.shouldRestore)setTimeout(function(){return b.restoreTarget(e)},0);else throw"Unknown load operation";}},{key:"isLoaded",value:function(a){return a.complete||!1}},{key:"injectLink",value:function(a,b){var c=this.resolveTarget(a);
a=c.target;c=c.registration;var e=c.extraData.type;if(e in this.options.linkHandler)(0,this.options.linkHandler[e])(a,b);else throw"Unknown link demand with content type: "+e;this.processSuccess(c)}},{key:"injectScript",value:function(a,b,c){var e=document.write,d="";document.write=function(a){return d+=a};(new Function(c+"\n//@ sourceURL="+b))();""!==d&&this.injectHtml(a,"<body>"+d+"</body>");document.write=e}},{key:"injectHtml",value:function(a,b){var c=this,e=document.createElement("html");e.innerHTML=
b;var d=e.getElementsByTagName("body"),f=1;b=!0;e=!1;var g=void 0;try{for(var k=d[Symbol.iterator](),l;!(b=(l=k.next()).done);b=!0){var n=l.value;d=!0;var p=!1,t=void 0;try{for(var q=n.children[Symbol.iterator](),u;!(d=(u=q.next()).done);d=!0){var r=u.value;"tagName"in r&&r.tagName.match(/script/i)?function(){var b=f;f+=1;var e=Promise.resolve(r.innerHTML);"src"in r&&r.src&&(e=fetch(r.src).then(function(a){if(!a.ok)throw Error(a.status+"_"+a.statusText);return a.text()}));e.then(function(e){c.injectScript(a,
a.href+".inline["+b+"].js",e)})}():a.parentNode.insertBefore(r,a)}}catch(v){p=!0,t=v}finally{try{!d&&q.return&&q.return()}finally{if(p)throw t;}}}}catch(v){e=!0,g=v}finally{try{!b&&k.return&&k.return()}finally{if(e)throw g;}}}},{key:"processSuccess",value:function(a){var b=this.resolveTarget(a);a=b.target;b=b.registration;var c=this.options.shouldInsertOnLoad(b.target),e=!0,d=!1,f=void 0;try{for(var g=b.placeholders[Symbol.iterator](),k;!(e=(k=g.next()).done);e=!0){var l=k.value;c&&(c=!1,l.parentNode.insertBefore(b.target,
l));this.cleanupPlaceholder(l)}}catch(n){d=!0,f=n}finally{try{!e&&g.return&&g.return()}finally{if(d)throw f;}}this.cleanupRegistrationTarget(b);this.options.onLoadSuccess.call(this,a);this.options.onLoadComplete.call(this,a)}},{key:"onLoadSuccess",value:function(a){}},{key:"cleanupPlaceholder",value:function(a){this.intersection.unobserve(a);a.parentNode.removeChild(a);this.phRegistry.delete(a)}},{key:"cleanupRegistrationTarget",value:function(a){this.intersection.unobserve(a.target);this.phRegistry.delete(a.target);
this.loaded.set(a.target,!0)}},{key:"handleError",value:function(a,b){var c=this.resolveTarget(a);a=c.target;c=c.registration;b&&b.stack&&b.message||(b=b?Error(b):Error("No error was provided on load"));var e=!0,d=!0,f=!1,g=void 0;try{for(var k=c.placeholders[Symbol.iterator](),l;!(d=(l=k.next()).done);d=!0){var n=l.value;e&&(e=!1,a.parentNode||n.parentNode.insertBefore(a,n),this.options.onLoadFailure.call(this,a,b));this.cleanupPlaceholder(n)}}catch(p){f=!0,g=p}finally{try{!d&&k.return&&k.return()}finally{if(f)throw g;
}}e&&this.options.onLoadFailure.call(this,a,b);this.cleanupRegistrationTarget(c);this.options.onLoadComplete.call(this,a)}},{key:"onLoadFailure",value:function(a,b){b=this.options.createFailureNode.call(this,a,b);b=Array.prototype.slice.call(b);var c=!0,e=!1,d=void 0;try{for(var f=b[Symbol.iterator](),g;!(c=(g=f.next()).done);c=!0)a.parentNode.insertBefore(g.value,a)}catch(k){e=!0,d=k}finally{try{!c&&f.return&&f.return()}finally{if(e)throw d;}}this.options.shouldRemove(a)&&a.parentNode.removeChild(a)}},
{key:"createFailureNode",value:function(){var a=document.createElement("div");a.innerHTML=this.options.failureHtml;return a.childNodes}},{key:"createLoadingNode",value:function(){var a=document.createElement("div");a.innerHTML=this.options.loadingHtml;return a.childNodes}},{key:"registerPlaceholder",value:function(a,b,c,e){b={isRegistration:!0,target:b,node:a,placeholders:c,extraData:e,loading:!1};this.phRegistry.set(a,b);return b}},{key:"resolveTarget",value:function(a){var b=a;"isRegistration"in
a&&a.isRegistration?a=b.target:b=this.phRegistry.get(a);return{target:a,registration:b}}},{key:"restoreTarget",value:function(a){var b=this.resolveTarget(a);a=b.target;b=b.registration;var c=b.extraData;b.loading=!0;this.options.onLoadBegin(a);this._restoreTargetInternal(a,c);c.canLoad||this.processSuccess(b)}},{key:"_restoreTargetInternal",value:function(a,b){b.hasSrcset&&a.setAttribute("srcset",b.srcset);b.hasSizes&&a.setAttribute("sizes",b.sizes);b.hasSrc&&a.setAttribute("src",b.src);if(0<b.children.length)for(a=
0;a<b.children.length;a++){var c=b.children[a];this._restoreTargetInternal(c.target,c)}}},{key:"captureTarget",value:function(a,b){var c=this,e={target:a,hasSrc:a.hasAttribute("src"),src:a.getAttribute("src"),hasSrcset:a.hasAttribute("srcset"),srcset:a.getAttribute("srcset"),hasSizes:a.hasAttribute("sizes"),sizes:a.getAttribute("sizes"),isLink:"tagName"in a&&a.tagName.match(/link/i),hasHref:a.hasAttribute("href"),href:a.getAttribute("href"),hasType:a.hasAttribute("type"),type:a.getAttribute("type"),
children:[],shouldRestore:!1,canLoad:!1,shouldInjectLink:!1};e.hasSrc&&a.removeAttribute("src");e.hasSrcset&&a.removeAttribute("srcset");e.hasSizes&&a.removeAttribute("sizes");e.isLink&&e.hasHref&&(e.shouldInjectLink=!0,e.hasType||(e.type="text/html"));(e.hasSrc||e.hasSrcset)&&a===b&&(e.shouldRestore=!0,e.canLoad=!0,a.addEventListener("load",function(a){return c.processSuccess(b)}),e.hasSrcset&&e.hasSrc?a.addEventListener("error",function(a){c.handleError(b,Error("Loading for srcset and src failed ("+
e.srcset+")("+e.src+")"))}):e.hasSrcset?a.addEventListener("error",function(a){c.handleError(b,Error("Loading for srcset failed ("+e.srcset+")"))}):e.hasSrc?a.addEventListener("error",function(a){c.handleError(b,Error("Loading for src failed ("+e.src+")"))}):a.addEventListener("error",function(a){c.handleError(b,Error("Loading srced element failed (FALLBACK ERROR MSG)"))}));if("tagName"in a&&a.tagName.match(/picture|video|audio/i)){a===b&&(e.shouldRestore=!0);for(var d=0;d<a.children.length;d++){var f=
this.captureTarget(a.children[d]);f.index=d;e.children.push(f)}}return e}},{key:"isContextExcluded",value:function(a){return a&&"parentNode"in a?(a=a.parentNode)&&"tagName"in a?a.tagName.match(/picture|video|audio/i)?!0:this.isContextExcluded(a):!1:!1}},{key:"observeTarget",value:function(a){if(!this.isLoaded(a)&&!this.isContextExcluded(a)){var b=this.captureTarget(a,a),c=this.options.createLoadingNode.call(this,a);c=Array.prototype.slice.call(c);var e=!0,d=!1,f=void 0;try{for(var g=c[Symbol.iterator](),
k;!(e=(k=g.next()).done);e=!0){var l=k.value;this.registerPlaceholder(l,a,c,b);a.parentNode.insertBefore(l,a);this.intersection.observe(l)}}catch(n){d=!0,f=n}finally{try{!e&&g.return&&g.return()}finally{if(d)throw f;}}this.registerPlaceholder(a,a,c,b);this.options.shouldRemove(a)?a.parentNode.removeChild(a):this.intersection.observe(a)}}},{key:"observeTargets",value:function(a){var b=!0,c=!1,e=void 0;try{for(var d=a[Symbol.iterator](),f;!(b=(f=d.next()).done);b=!0)this.observeTarget(f.value)}catch(g){c=
!0,e=g}finally{try{!b&&d.return&&d.return()}finally{if(c)throw e;}}}},{key:"isTargetMatch",value:function(a){return this.loaded.has(a)?!1:"matches"in a&&a.matches(this.options.selector)}},{key:"queryTargets",value:function(){var a=[],b=!0,c=!1,e=void 0;try{for(var d=document.querySelectorAll(this.options.selector)[Symbol.iterator](),f;!(b=(f=d.next()).done);b=!0)a.push(f.value)}catch(g){c=!0,e=g}finally{try{!b&&d.return&&d.return()}finally{if(c)throw e;}}return a}},{key:"shouldRemove",value:function(a){return!("tagName"in
a)||!a.tagName.match(/link/i)}}]);return d}();window.DemandJS=d})(window);
