{"version":3,"sources":["../demand.js"],"names":[],"mappings":";;;;;;AAAA,CAAC,UAAU,GAAV,EAAe;AAAA,MACR,QADQ;AAAA;AAAA;AAAA,sCAEI,SAFJ,EAEe;AAAA;AAAA;AAAA;;AAAA;AACzB,+BAAqB,SAArB,8HAAgC;AAAA,gBAAvB,QAAuB;;AAC9B,gBAAI,SAAS,IAAT,KAAkB,WAAtB,EAAmC;AAAE;AAAW;AADlB;AAAA;AAAA;;AAAA;AAE9B,oCAAkB,SAAS,UAA3B,mIAAuC;AAAA,oBAA9B,KAA8B;;AACrC,oBAAI,KAAK,aAAL,CAAmB,KAAnB,CAAJ,EAA+B;AAC7B,uBAAK,aAAL,CAAmB,KAAnB;AACD;AACF;AAN6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAO/B;AARwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAS1B;AAXW;AAAA;AAAA,0CAYQ,aAZR,EAYuB;AAAA;AAAA;AAAA;;AAAA;AACjC,gCAAsB,aAAtB,mIAAqC;AAAA,gBAA5B,SAA4B;;AACnC,gBAAI,CAAC,UAAU,cAAf,EAA+B;AAAE;AAAW;AAC5C,gBAAI,MAAM,KAAK,UAAL,CAAgB,GAAhB,CAAoB,UAAU,MAA9B,CAAV;AACA,gBAAI,QAAQ,SAAR,IAAqB,IAAI,OAA7B,EAAsC;AAAE;AAAW;AACnD,gBAAI,OAAJ,GAAc,IAAd;AACA,iBAAK,SAAL,CAAe,GAAf;AACD;AAPgC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQlC;AApBW;AAAA;AAAA,gCAqBF,YArBE,EAqBY;AAAA;;AACtB,YAAI,aAAa,SAAb,CAAuB,MAAvB,IACA,aAAa,SAAb,CAAuB,OAD3B,EACoC;AAClC,cAAI,MAAM,aAAa,SAAb,CAAuB,IAAjC;AACA,gBAAM,GAAN,EAAW,IAAX,CAAgB,UAAU,QAAV,EAAoB;AAClC,gBAAI,CAAC,SAAS,EAAd,EAAkB;AAChB,oBAAM,MAAM,SAAS,MAAT,GAAkB,GAAlB,GAAwB,SAAS,UAAvC,CAAN;AACD;AACD,mBAAO,SAAS,IAAT,EAAP;AACD,WALD,EAKG,IALH,CAKQ,eAAK;AACX,kBAAK,UAAL,CAAgB,aAAa,MAA7B,EAAqC,GAArC;AACD,WAPD,EAOG,KAPH,CAOS,cAAI;AACX,kBAAK,WAAL,CAAiB,YAAjB,EAA+B,EAA/B;AACD,WATD;AAUD,SAbD,MAaO,IAAI,aAAa,SAAb,CAAuB,MAA3B,EAAmC;AACxC,uBAAa,MAAb,CAAoB,gBAApB,CAAqC,MAArC,EAA6C;AAAA,mBAAK,MAAK,cAAL,CAAoB,YAApB,CAAL;AAAA,WAA7C;AACA,uBAAa,MAAb,CAAoB,gBAApB,CAAqC,OAArC,EAA8C;AAAA,mBAAK,MAAK,WAAL,CAAiB,YAAjB,EAA+B,GAA/B,CAAL;AAAA,WAA9C;AACA;AACA,qBAAW;AAAA,mBAAI,aAAa,MAAb,CAAoB,YAApB,CAAiC,KAAjC,EAAwC,aAAa,SAAb,CAAuB,GAA/D,CAAJ;AAAA,WAAX,EAAoF,CAApF;AACD,SALM,MAKA;AACL,gBAAM,wBAAN;AACD;AACF;AA3CW;AAAA;AAAA,+BA4CH,MA5CG,EA4CK;AACf,eAAO,OAAO,QAAP,IAAmB,KAA1B;AACD;AA9CW;AAAA;AAAA,iCA+CD,MA/CC,EA+CO,GA/CP,EA+CY;AACtB,YAAI,OAAO,IAAP,CAAY,KAAZ,CAAkB,UAAlB,CAAJ,EAAmC;AACjC,cAAI,MAAM,KAAK,UAAL,CAAgB,GAAhB,CAAoB,MAApB,CAAV;AACA,eAAK,UAAL,CAAgB,MAAhB,EAAwB,GAAxB;AACA,eAAK,cAAL,CAAoB,GAApB;AACD,SAJD,MAIO;AACL,gBAAM,MAAM,6CAA6C,OAAO,IAA1D,CAAN;AACD;AACF;AAvDW;AAAA;AAAA,mCAwDC,MAxDD,EAwDS,EAxDT,EAwDa,IAxDb,EAwDmB;AAC7B,YAAI,QAAQ,SAAS,KAArB;AACA,YAAI,UAAU,EAAd;AACA,iBAAS,KAAT,GAAiB;AAAA,iBAAG,WAAW,CAAd;AAAA,SAAjB;;AAEA,YAAI,gBAAgB,IAAI,QAAJ,CAAa,OAAO,IAAP,GAAc,gBAAd,GAAiC,EAA9C,CAApB;AACA;;AAEA,YAAI,YAAY,EAAhB,EAAoB;AAClB,eAAK,UAAL,CAAgB,MAAhB,EAAwB,WAAW,OAAX,GAAqB,SAA7C;AACD;;AAED,iBAAS,KAAT,GAAiB,KAAjB;AACD;AArEW;AAAA;AAAA,iCAsED,MAtEC,EAsEO,GAtEP,EAsEY;AAAA;;AACtB,YAAI,OAAO,SAAS,aAAT,CAAuB,MAAvB,CAAX;AACA,aAAK,SAAL,GAAiB,GAAjB;AACA,YAAI,SAAS,KAAK,oBAAL,CAA0B,MAA1B,CAAb;AACA,YAAI,WAAW,CAAf;AAJsB;AAAA;AAAA;;AAAA;AAKtB,gCAAiB,MAAjB,mIAAyB;AAAA,gBAAhB,IAAgB;AAAA;AAAA;AAAA;;AAAA;AACvB,oCAAe,KAAK,QAApB,mIAA8B;AAAA,oBAArB,EAAqB;;AAC5B,oBAAI,aAAa,EAAb,IAAmB,GAAG,OAAH,CAAW,KAAX,CAAiB,SAAjB,CAAvB,EAAoD;AAAA;AAClD,wBAAI,gBAAgB,QAApB;AACA,gCAAY,CAAZ;AACA,wBAAI,cAAc,QAAQ,OAAR,CAAgB,GAAG,SAAnB,CAAlB;AACA,wBAAI,SAAS,EAAT,IAAe,CAAE,CAAE,GAAG,GAA1B,EAAiC;AAC/B,oCAAc,MAAM,GAAG,GAAT,EAAc,IAAd,CAAmB,oBAAU;AACzC,4BAAI,CAAC,SAAS,EAAd,EAAkB;AAChB,gCAAM,MAAM,SAAS,MAAT,GAAkB,GAAlB,GAAwB,SAAS,UAAvC,CAAN;AACD;AACD,+BAAO,SAAS,IAAT,EAAP;AACD,uBALa,CAAd;AAMD;AACD,gCAAY,IAAZ,CAAiB,gBAAM;AACrB,6BAAK,YAAL,CAAkB,MAAlB,EAA0B,OAAO,IAAP,GAAc,UAAd,GAA2B,aAA3B,GAA2C,MAArE,EAA6E,IAA7E;AACD,qBAFD;AAZkD;AAenD,iBAfD,MAeO;AACL,yBAAO,UAAP,CAAkB,YAAlB,CAA+B,EAA/B,EAAmC,MAAnC;AACD;AACF;AApBsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBxB;AA1BqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA2BvB;AAjGW;AAAA;AAAA,qCAkGG,YAlGH,EAkGiB;AAC3B,YAAI,QAAQ,KAAK,OAAL,CAAa,kBAAb,CAAgC,aAAa,MAA7C,CAAZ;AAD2B;AAAA;AAAA;;AAAA;AAE3B,gCAAwB,aAAa,YAArC,mIAAmD;AAAA,gBAA1C,WAA0C;;AACjD,gBAAI,KAAJ,EAAW;AACT,sBAAQ,KAAR;AACA,0BAAY,UAAZ,CAAuB,YAAvB,CAAoC,aAAa,MAAjD,EAAyD,WAAzD;AACD;AACD,iBAAK,kBAAL,CAAwB,WAAxB;AACD;AAR0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAS3B,aAAK,yBAAL,CAA+B,YAA/B;AACD;AA5GW;AAAA;AAAA,yCA6GO,WA7GP,EA6GoB;AAC5B,aAAK,YAAL,CAAkB,SAAlB,CAA4B,WAA5B;AACA,oBAAY,UAAZ,CAAuB,WAAvB,CAAmC,WAAnC;AACA,aAAK,UAAL,CAAgB,MAAhB,CAAuB,WAAvB;AACH;AAjHW;AAAA;AAAA,gDAkHc,YAlHd,EAkH4B;AACtC,aAAK,YAAL,CAAkB,SAAlB,CAA4B,aAAa,MAAzC,EADsC,CACY;AAClD,aAAK,UAAL,CAAgB,MAAhB,CAAuB,aAAa,MAApC;AACD;AArHW;AAAA;AAAA,kCAsHA,YAtHA,EAsHc,GAtHd,EAsHmB;AAC7B,YAAI,QAAQ,IAAZ;AAD6B;AAAA;AAAA;;AAAA;AAE7B,gCAAwB,aAAa,YAArC,mIAAmD;AAAA,gBAA1C,WAA0C;;AACjD,gBAAI,KAAJ,EAAW;AACT,sBAAQ,KAAR;AACA,kBAAI,UAAU,KAAK,OAAL,CAAa,eAAb,CAA6B,aAAa,MAA1C,CAAd;AAFS;AAAA;AAAA;;AAAA;AAGT,sCAAgB,OAAhB,mIAAyB;AAAA,sBAAhB,GAAgB;;AACvB,8BAAY,UAAZ,CAAuB,YAAvB,CAAoC,GAApC,EAAyC,WAAzC;AACD;AALQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMV;AACD,iBAAK,kBAAL,CAAwB,WAAxB;AACD;AAX4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAa7B,aAAK,yBAAL,CAA+B,YAA/B;AACD;AApIW;AAAA;AAAA,wCAqIM;AAChB,YAAI,MAAM,SAAS,aAAT,CAAuB,KAAvB,CAAV;AACA,YAAI,SAAJ,GAAgB,KAAK,OAAL,CAAa,SAA7B;AACA,eAAO,MAAM,SAAN,CAAgB,KAAhB,CAAsB,IAAtB,CAA2B,IAAI,UAA/B,CAAP;AACD;AAzIW;AAAA;AAAA,0CA0IQ;AAClB,YAAI,MAAM,SAAS,aAAT,CAAuB,KAAvB,CAAV;AACA,YAAI,SAAJ,GAAgB,KAAK,OAAL,CAAa,WAA7B;AACA,eAAO,MAAM,SAAN,CAAgB,KAAhB,CAAsB,IAAtB,CAA2B,IAAI,UAA/B,CAAP;AACD;AA9IW;AAAA;AAAA,0CA+IQ,IA/IR,EA+Ic,MA/Id,EA+IsB,YA/ItB,EA+IoC,SA/IpC,EA+I+C;AACzD,aAAK,UAAL,CAAgB,GAAhB,CAAoB,IAApB,EAA0B;AACxB,kBAAQ,MADgB;AAExB,gBAAM,IAFkB;AAGxB,wBAAc,YAHU;AAIxB,qBAAW,SAJa;AAKxB,mBAAS;AALe,SAA1B;AAOD;AAvJW;AAAA;AAAA,oCAwJE,MAxJF,EAwJU;AACpB,YAAI,KAAK,QAAL,CAAc,MAAd,CAAJ,EAA2B,CAE1B,CAFD,MAEO;AACL,cAAI,QAAQ;AACV,sBAAW,OAAO,YAAP,CAAoB,KAApB,CADD;AAEV,mBAAQ,OAAO,YAAP,CAAoB,KAApB,CAFE;AAGV,sBAAW,aAAa,MAAd,IAA0B,OAAO,OAAP,CAAe,KAAf,CAAqB,OAArB,CAH1B;AAIV,uBAAW,OAAO,YAAP,CAAoB,MAApB,CAJD;AAKV,oBAAQ,OAAO,YAAP,CAAoB,MAApB;AALE,WAAZ;AAOA,cAAI,MAAM,MAAV,EAAkB;AAChB,mBAAO,eAAP,CAAuB,KAAvB;AACD;AACD,cAAI,eAAe,KAAK,OAAL,CAAa,iBAAb,CAA+B,MAA/B,CAAnB;AAXK;AAAA;AAAA;;AAAA;AAYL,kCAAwB,YAAxB,mIAAsC;AAAA,kBAA7B,WAA6B;;AACpC,mBAAK,mBAAL,CAAyB,WAAzB,EAAsC,MAAtC,EAA8C,YAA9C,EAA4D,KAA5D;AACA,qBAAO,UAAP,CAAkB,YAAlB,CAA+B,WAA/B,EAA4C,MAA5C;AACA,mBAAK,YAAL,CAAkB,OAAlB,CAA0B,WAA1B;AACD;AAhBI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAiBL,eAAK,mBAAL,CAAyB,MAAzB,EAAiC,MAAjC,EAAyC,YAAzC,EAAuD,KAAvD;AACA,cAAI,KAAK,OAAL,CAAa,YAAb,CAA0B,MAA1B,CAAJ,EAAuC;AACrC,mBAAO,UAAP,CAAkB,WAAlB,CAA8B,MAA9B;AACD,WAFD,MAEO;AACL,iBAAK,YAAL,CAAkB,OAAlB,CAA0B,MAA1B;AACD;AACF;AACF;AAnLW;AAAA;AAAA,qCAoLG,OApLH,EAoLY;AAAA;AAAA;AAAA;;AAAA;AACtB,iCAAmB,OAAnB,wIAA4B;AAAA,gBAAnB,MAAmB;;AAC1B,iBAAK,aAAL,CAAmB,MAAnB;AACD;AAHqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIvB;AAxLW;AAAA;AAAA,oCAyLE,MAzLF,EAyLU;AACpB,eAAO,aAAa,MAAb,IAAuB,OAAO,OAAP,CAAe,KAAK,OAAL,CAAa,QAA5B,CAA9B;AACD;AA3LW;AAAA;AAAA,qCA4LG;AACb,YAAI,SAAS,EAAb;AADa;AAAA;AAAA;;AAAA;AAEb,iCAAiB,SAAS,gBAAT,CAA0B,KAAK,OAAL,CAAa,QAAvC,CAAjB,wIAAmE;AAAA,gBAA1D,IAA0D;;AACjE,mBAAO,IAAP,CAAY,IAAZ;AACD;AAJY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKb,eAAO,MAAP;AACD;AAlMW;AAAA;AAAA,mCAmMC,CAnMD,EAmMI;AACd,eAAO,EAAE,aAAa,CAAf,KAAqB,CAAE,EAAE,OAAF,CAAU,KAAV,CAAgB,OAAhB,CAA9B;AACD;AArMW;;AAsMZ,sBAAY,OAAZ,EAAqB;AAAA;;AAAA;;AACnB,WAAK,UAAL,GAAkB,IAAI,OAAJ,EAAlB;AACA,WAAK,OAAL,GAAe,OAAO,MAAP,CAAc;AAC3B,qBAAa,+DADc;AAE3B,mBAAW,2EAFgB;AAG3B,2BAAmB;AAAA,iBAAG,OAAK,iBAAL,EAAH;AAAA,SAHQ;AAI3B,yBAAiB;AAAA,iBAAG,OAAK,eAAL,EAAH;AAAA,SAJU;AAK3B,sBAAc;AAAA,iBAAG,EAAE,aAAa,CAAf,KAAqB,CAAE,EAAE,OAAF,CAAU,KAAV,CAAgB,OAAhB,CAA1B;AAAA,SALa;AAM3B,4BAAoB;AAAA,iBAAG,OAAK,OAAL,CAAa,YAAb,CAA0B,CAA1B,CAAH;AAAA,SANO;AAO3B,kBAAU;AAPiB,OAAd,EAQZ,OARY,CAAf;AASA,WAAK,QAAL,GAAgB,IAAI,gBAAJ,CAAqB,UAAC,CAAD,EAAG,CAAH;AAAA,eAAO,OAAK,eAAL,CAAqB,CAArB,EAAuB,CAAvB,CAAP;AAAA,OAArB,CAAhB;AACA,WAAK,eAAL,GAAuB;AACrB,mBAAW,IADU;AAErB,iBAAS;AAFY,OAAvB;;AAKA,WAAK,mBAAL,GAA2B;AACzB,cAAM,IADmB;AAEzB,oBAAY,MAFa;AAGzB,mBAAW;AAHc,OAA3B;AAKA,WAAK,YAAL,GAAoB,IAAI,oBAAJ,CAA0B,UAAC,CAAD,EAAG,CAAH;AAAA,eAAO,OAAK,mBAAL,CAAyB,CAAzB,EAA2B,CAA3B,CAAP;AAAA,OAA1B,EAAgE,KAAK,mBAArE,CAApB;;AAEA,WAAK,cAAL,CAAoB,KAAK,YAAL,EAApB;AACA,WAAK,QAAL,CAAc,OAAd,CAAsB,SAAS,IAA/B,EAAqC,KAAK,eAA1C;AACD;;AAhOW;AAAA;;AAmOd,SAAO,QAAP,GAAkB,QAAlB;AACD,CApOD,EAoOG,MApOH","file":"demand.js","sourcesContent":["(function (ctx) {\n  class DemandJS {\n    observeMutation(mutations) {\n      for (var mutation of mutations) {\n        if (mutation.type !== 'childList') { continue; }\n        for (var added of mutation.addedNodes) {\n          if (this.isTargetMatch(added)) {\n            this.observeTarget(added);\n          }\n        }\n      }\n    }\n    observeIntersection(intersections) {\n      for (var intersect of intersections) {\n        if (!intersect.isIntersecting) { continue; }\n        let reg = this.phRegistry.get(intersect.target);\n        if (reg === undefined || reg.loading) { continue; }\n        reg.loading = true;\n        this.beginLoad(reg);   \n      }\n    }\n    beginLoad(registration) {\n      if (registration.extraData.isLink &&\n          registration.extraData.hasHref) {\n        let url = registration.extraData.href;\n        fetch(url).then(function (response) {\n          if (!response.ok) {\n            throw Error(response.status + '_' + response.statusText);\n          }\n          return response.text();\n        }).then(txt=>{\n          this.injectLink(registration.target, txt);\n        }).catch(ex=>{\n          this.onLoadError(registration, ex);\n        });\n      } else if (registration.extraData.hasSrc) {\n        registration.target.addEventListener('load', evt=>this.onLoadComplete(registration));\n        registration.target.addEventListener('error', evt=>this.onLoadError(registration, evt));\n        // setTimeout helps here helps keep loading animations smooth\n        setTimeout(()=>registration.target.setAttribute('src', registration.extraData.src), 0);\n      } else {\n        throw 'Unknown load operation';\n      }\n    }\n    isLoaded(target) {\n      return target.complete || false;\n    }\n    injectLink(target, txt) {\n      if (target.href.match(/\\.html$/i)) {\n        let reg = this.phRegistry.get(target);\n        this.injectHtml(target, txt);\n        this.onLoadComplete(reg);\n      } else {\n        throw Error('Not implemented link injection with url ' + target.href);\n      }\n    }\n    injectScript(target, id, code) {\n      var oldDw = document.write;\n      var content = '';\n      document.write = c=>content += c;\n\n      var codeToExecute = new Function(code + \"\\n\" + '//@ sourceURL=' + id);\n      codeToExecute();\n     \n      if (content !== '') { \n        this.injectHtml(target, '<body>' + content + '</body>');\n      }\n\n      document.write = oldDw;\n    }\n    injectHtml(target, txt) {\n      var root = document.createElement('html');\n      root.innerHTML = txt;\n      var bodies = root.getElementsByTagName('body');\n      let scriptId = 1;\n      for (var body of bodies) {\n        for (var bc of body.children) {\n          if ('tagName' in bc && bc.tagName.match(/script/i)) {\n            let localScriptId = scriptId;\n            scriptId += 1;\n            let codePromise = Promise.resolve(bc.innerHTML);\n            if ('src' in bc && !(!(bc.src))) {\n              codePromise = fetch(bc.src).then(response=>{\n                if (!response.ok) {\n                  throw Error(response.status + '_' + response.statusText);\n                }\n                return response.text();\n              }); \n            }\n            codePromise.then(code=>{\n              this.injectScript(target, target.href + '.inline[' + localScriptId + '].js', code);\n            });\n          } else {\n            target.parentNode.insertBefore(bc, target);\n          }\n        }\n      }\n    }\n    onLoadComplete(registration) {\n      let first = this.options.shouldInsertOnLoad(registration.target);\n      for (var placeholder of registration.placeholders) {\n        if (first) {\n          first = false;\n          placeholder.parentNode.insertBefore(registration.target, placeholder);\n        }\n        this.cleanupPlaceholder(placeholder);\n      }\n      this.cleanupRegistrationTarget(registration);\n    }\n    cleanupPlaceholder(placeholder) {\n        this.intersection.unobserve(placeholder);\n        placeholder.parentNode.removeChild(placeholder);\n        this.phRegistry.delete(placeholder);\n    }\n    cleanupRegistrationTarget(registration) {\n      this.intersection.unobserve(registration.target); // this only necesarry when we didnt remove the item\n      this.phRegistry.delete(registration.target);\n    }\n    onLoadError(registration, evt) {\n      let first = true;\n      for (var placeholder of registration.placeholders) {\n        if (first) {\n          first = false;\n          var errorUI = this.options.createErrorNode(registration.target);\n          for (var eui of errorUI) {\n            placeholder.parentNode.insertBefore(eui, placeholder);\n          }\n        }\n        this.cleanupPlaceholder(placeholder);\n      }\n\n      this.cleanupRegistrationTarget(registration);\n    }\n    createErrorNode() {\n      var ele = document.createElement('div');\n      ele.innerHTML = this.options.errorHTML;\n      return Array.prototype.slice.call(ele.childNodes);\n    }\n    createPlaceholder() {\n      var ele = document.createElement('div');\n      ele.innerHTML = this.options.pendingHTML;\n      return Array.prototype.slice.call(ele.childNodes);\n    }\n    registerPlaceholder(node, target, placeholders, extraData) {\n      this.phRegistry.set(node, {\n        target: target,\n        node: node,\n        placeholders: placeholders,\n        extraData: extraData,\n        loading: false\n      });\n    }\n    observeTarget(target) {\n      if (this.isLoaded(target)) {\n        \n      } else {\n        var store = {\n          'hasSrc':  target.hasAttribute('src'),\n          'src':  target.getAttribute('src'),\n          'isLink': ('tagName' in target) && (target.tagName.match(/link/i)),\n          'hasHref': target.hasAttribute('href'),\n          'href': target.getAttribute('href')\n        };\n        if (store.hasSrc) {\n          target.removeAttribute('src');\n        }\n        var placeholders = this.options.createPlaceholder(target);\n        for (var placeholder of placeholders) {\n          this.registerPlaceholder(placeholder, target, placeholders, store);\n          target.parentNode.insertBefore(placeholder, target);\n          this.intersection.observe(placeholder);\n        }\n        this.registerPlaceholder(target, target, placeholders, store);\n        if (this.options.shouldRemove(target)) {\n          target.parentNode.removeChild(target);\n        } else {\n          this.intersection.observe(target);\n        }\n      }\n    }\n    observeTargets(targets) {\n      for (var target of targets) {\n        this.observeTarget(target);\n      }\n    }\n    isTargetMatch(target) {\n      return 'matches' in target && target.matches(this.options.selector);\n    }\n    queryTargets() {\n      let result = [];\n      for (var node of document.querySelectorAll(this.options.selector)) {\n        result.push(node);\n      }\n      return result;\n    }\n    shouldRemove(t) {\n      return !('tagName' in t) || !(t.tagName.match(/link/i)); \n    }\n    constructor(options) {\n      this.phRegistry = new WeakMap();\n      this.options = Object.assign({\n        pendingHTML: '<div style=\"width:100%;height:100%\">Loading In Progress</div>',\n        errorHTML: '<div style=\"background-color:#F00;color:#FFF;font-size:20pt;\">ERROR</div>',\n        createPlaceholder: t=>this.createPlaceholder(),\n        createErrorNode: t=>this.createErrorNode(),\n        shouldRemove: t=>!('tagName' in t) || !(t.tagName.match(/link/i)),\n        shouldInsertOnLoad: t=>this.options.shouldRemove(t),\n        selector: 'img,video,iframe,link.demand'\n      }, options);\n      this.mutation = new MutationObserver((a,b)=>this.observeMutation(a,b));\n      this.mutationOptions = {\n        childList: true,\n        subtree: true\n      };\n\n      this.intersectionOptions = {\n        root: null,\n        rootMargin: '48px',\n        threshold: 0.1\n      };\n      this.intersection = new IntersectionObserver( (a,b)=>this.observeIntersection(a,b), this.intersectionOptions);\n\n      this.observeTargets(this.queryTargets());\n      this.mutation.observe(document.body, this.mutationOptions);\n    }\n  }\n\n  window.DemandJS = DemandJS;\n})(window);\n"]}