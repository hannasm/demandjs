{"version":3,"sources":["../demand.js"],"names":[],"mappings":"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","file":"demand.js","sourcesContent":["/** @preserve DemandJS - v.1.0.0-rc.8\n *\n * https://github.com/hannasm/demandjs\n *\n **/\n(function (ctx) {\n  class DemandJS {\n    observeMutation(mutations) {\n      for (var i = 0; i < mutations.length; i++) {\n        var mutation = mutations[i];\n        if (mutation.type !== 'childList') { continue; }\n        for (var j = 0; j < mutation.addedNodes.length; j++) {\n          var added = mutation.addedNodes[j];\n          // haven't identified why this happens, maybe document.createElement()?\n          if (!added.parentNode) { continue; }\n          this.checkAdditionRecursive(added);\n        }\n        for (var j = 0; j < mutation.removedNodes.length; j++) {\n          var removed = mutation.removedNodes[j];\n          this.checkRemovalsRecursive(removed);\n        }\n      }\n    }\n    checkRemovalsRecursive(removed) {\n      var remaining = [removed];\n      while (remaining.length > 0) {\n        removed = remaining.shift();\n        if (this.hasRegistration(removed)) {\n          var {target, registration} = this.resolveTarget(removed);\n\n          if (!registration.loaded) { continue; }\n\n          if (registration.expectRemove) {\n            registration.expectRemove = false;\n            continue;\n          }\n          if (target.node === target.target) {\n            this.cleanupRegistrationTarget(registration);\n            continue;\n          } else {\n            this.cleanupPlaceholder(registration);\n            continue;\n          }\n        }\n\n        if (removed.children) {\n          for (var i = 0; i < removed.children.length; i++) {\n            remaining.push(removed.children[i]);\n          }\n        }\n      }\n    }\n    checkAdditionRecursive(added) {\n      var remaining = [added];\n      while (remaining.length > 0) {\n        added = remaining.shift();\n        if (this.observed.has(added)) { continue; }\n        this.observed.set(added, true);\n        \n        var res = this.isTargetMatch(added);\n        if (!res.loaded) {\n          if (res.isScript && res.injecting) {\n            this.injectedScript(added, res.injecting);\n            continue;\n          } else if (res.isMatch) {\n            this.observeTarget(added);\n            continue;\n          }\n        } \n\n        if(added.children) {\n          for (var i = 0; i < added.children.length; i++) {\n            var child = added.children[i];\n            remaining.push(child);\n          }\n        }\n      }\n    }\n    observeAttributeMutation(mutations) {\n      for (var i = 0; i < mutations.length; i++) {\n        var mutation = mutations[i];\n        if (mutation.type !== 'attributes') { continue; }\n        var node = mutation.target;\n        var aname = mutation.attributeName;\n        var {target, registration} = this.resolveTarget(node);\n        if (!registration.loaded) { \n          if (!target.hasAttribute(aname)) { continue; }\n          if (val == registration.extraData[aname]) { continue; }\n          if (val === '') { continue; }\n\n          let reg = registration;\n          let val = target.getAttribute(aname);\n          switch (aname) {\n            case \"src\":\n              reg.extraData.src = val;\n              reg.extraData.hasSrc = true;\n              if (!registration.loading) { target.removeAttribute('src'); }\n              break;\n            case 'href':\n              reg.extraData.href = val;\n              reg.extraData.hasHref = true;\n              break;\n            case 'srcset':\n              reg.extraData.srcset = val;\n              reg.extraData.hasSrcset = true;\n              if (!registration.loading) { target.removeAttribute('srcset'); }\n              break;\n            case 'sizes':\n              reg.extraData.sizes = val;\n              reg.extraData.hasSizes = true;\n              if (!registration.loading) { target.removeAttribute('sizes'); }\n              break;\n            case 'type':\n              reg.extraData.type = val;\n              reg.extraData.hasType = true;\n              break;\n          }\n          continue; \n        }\n\n        this.cleanupRegistrationTarget(target);\n\n        var mc = this.isTargetMatch(target);\n        if (mc.isMatch) {\n          this.observeTarget(target);\n          return;\n        }\n      }\n    }\n    observeIntersection(intersections) {\n      for (var i = 0; i < intersections.length; i++) {\n        var intersect = intersections[i];\n        if (intersect.isIntersecting && intersect.intersectionRatio > 0) { \n          let reg = this.phRegistry.get(intersect.target);\n          if (reg === undefined || reg.loading) { continue; }\n          reg = this.phRegistry.get(reg.target);\n          if (reg === undefined || reg.loading) { continue; }\n          this.beginLoad(reg);   \n        }\n      }\n    }\n    observeOutersection(intersections) {\n      for (var i = 0; i < intersections.length; i++) {\n        var intersect = intersections[i];\n        if (!intersect.isIntersecting || intersect.intersectionRatio <= 0) { \n          let reg = this.phRegistry.get(intersect.target);\n          if (reg === undefined) { continue; }\n          reg = this.phRegistry.get(reg.target);\n          if (reg === undefined) { continue; }\n          if (!reg.loaded) { continue; }\n          var target = reg.target;\n          var dims = target.getBoundingClientRect();\n          target.setAttribute('data-demandjs-width', dims.width);\n          target.setAttribute('data-demandjs-height', dims.height);\n          this.cleanupRegistrationTarget(target);\n\n          var mc = this.isTargetMatch(target);\n          if (mc.isMatch) {\n            this.observeTarget(target, reg);\n          }\n        }\n      }\n    }\n    beginLoad(target) {\n      var {target, registration} = this.resolveTarget(target);\n      registration.loading = true;\n      if (registration.extraData.shouldInjectLink) {\n        let url = registration.extraData.href;\n\n        let onLoadBegin = this.selectByDemandClass(\n            target, this.options.onLoadBegin,\n            this.options.demandClassAttribute,\n            this.options.defaultDemandClass,\n            this.onLoadBegin);\n        onLoadBegin.call(this, target);\n\n        url = this.predictUrl(target, url);\n        registration.extraData.startTime = performance.now();\n\n        fetch(url).then(function (response) {\n          if (!response.ok) {\n            var error = new Error('Fetching \"' + url + '\" failed with ' + response.status + ' ' + response.statusText);\n            error.responseDetail = response;\n            throw error;\n          }\n          return response.text();\n        }).then(txt=>{\n          this.injectLink(registration, txt);\n        }).catch(ex=>{\n          this.handleError(registration, ex);\n        });\n      } else if (registration.extraData.shouldRestore) {\n        // setTimeout helps keep loading animations smooth\n        setTimeout(()=>this.restoreTarget(registration), 0);\n      } else {\n        throw 'Unknown load operation';\n      }\n    }\n    isResourceLoaded(target) {\n      return target.loaded || false;\n    }\n    injectLink(target, txt) {\n      var {target, registration} = this.resolveTarget(target);\n\n      let previewLoading = this.selectByDemandClass(\n          target, this.options.previewLoading,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          false);\n      // if loading preview requested, never finish loading anything\n      if (previewLoading) { return; }\n\n      let previewFailure = this.selectByDemandClass(\n          target, this.options.previewFailure,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          false);\n      // if error preview requested, treat load success as load errors\n      if (previewFailure) {\n        this.handleError(target, new Error('found failure preview in options'));\n        return;\n      }\n\n      var type = registration.extraData.type;\n      if (type in this.options.linkHandler) {\n        var handler = this.options.linkHandler[type];\n        handler(target, txt);\n      } else {\n        throw 'Unknown link demand with content type: ' + type;\n      }\n      this.processSuccess(registration);\n    }\n    injectedScript(bc, injecting) {\n      let localScriptId = injecting.id;\n      let codePromise = Promise.resolve(bc.innerHTML);\n      if ('src' in bc && !(!(bc.src))) {\n        codePromise = fetch(bc.src).then(response=>{\n          if (!response.ok) {\n            throw Error(response.status + '_' + response.statusText);\n          }\n          return response.text();\n        });\n        localScriptId = bc.src + '#' + localScriptId;\n      }\n      codePromise.then(code=>{\n        this.injectScript(bc, injecting.href + '.demand[' + localScriptId + '].js', code);\n      });\n    }\n    injectScript(target, id, code) {\n      var oldDw = document.write;\n      var content = '';\n      document.write = c=>content += c;\n\n      var codeToExecute = new Function(code + \"\\n\" + '//@ sourceURL=' + id);\n      codeToExecute();\n     \n      if (content !== '') { \n        this.injectHtml(target, '<body>' + content + '</body>');\n      }\n\n      document.write = oldDw;\n    }\n    injectHtml(target, txt) {\n      var {target, registration} = this.resolveTarget(target);\n\n      var root = document.createElement('html');\n      root.innerHTML = txt;\n      var bodies = root.getElementsByTagName('body');\n      let injectionId = 1;\n      bodies = Array.prototype.slice.call(bodies);\n      for (var i = 0; i< bodies.length; i++) {\n        var body = bodies[i];\n        var clds = Array.prototype.slice.call(body.children);\n        for (var j = 0; j < clds.length; j++) {\n          var bc = clds[j];\n          this.injecting.set(bc, {\n            href: target.href,\n            id: injectionId \n          });\n          injectionId += 1;\n          this.scrollSave();\n          target.parentNode.insertBefore(bc, target);\n          this.scrollRestore();\n          registration.elements.push(bc);\n        }\n      }\n    }\n    shouldTrackOffloading(target) {\n      if (target.nodeName !== 'IMG' &&\n        target.nodeName !== 'VIDEO' &&\n        target.nodeName !== 'PICTURE') {\n        return false;\n      }\n      return this.options.enableOffloading;\n    }\n    processSuccess(target) {\n      var {target, registration} = this.resolveTarget(target);\n\n      let previewLoading = this.selectByDemandClass(\n          target, this.options.previewLoading,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          false);\n      // if loading preview requested, never finish loading anything\n      if (previewLoading) { return; }\n\n      let previewFailure = this.selectByDemandClass(\n          target, this.options.previewFailure,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          false);\n      // if error preview requested, treat load success as load errors\n      if (previewFailure) {\n        this.handleError(target, new Error('found failure preview in options'));\n        return;\n      }\n\n      // iframe load event being triggered twice\n      if (!registration || registration.loaded) { return; }\n\n      if (registration.extraData.insertToLoad) {\n          var ph = registration.placeholders[0];\n          var cap = registration.extraData;\n          registration.target.style.display = cap.display;\n          registration.expectRemove = true;\n          this.scrollSave();\n          ph.parentNode.insertBefore(registration.target, ph);\n          this.scrollRestore();\n      } else if (this.options.shouldInsertOnLoad(registration.target)) {\n          var ph = registration.placeholders[0];\n          var cap = registration.extraData;\n          registration.target.style.display = cap.display;\n      }\n\n      // remove all placeholders\n      this.cleanupPlaceholders(registration);\n\n      registration.loaded = true;\n      registration.extraData.endTime = performance.now();\n      this.recordPerformance(target, false);\n\n      if (this.shouldTrackOffloading(target)) {\n        this.outersection.observe(target);\n      }\n\n      let onLoadSuccess = this.selectByDemandClass(\n          target, this.options.onLoadSuccess,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          this.onLoadSuccess);\n      onLoadSuccess.call(this, target);\n      let onLoadComplete = this.selectByDemandClass(\n          target, this.options.onLoadComplete,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          this.onLoadComplete);\n      onLoadComplete.call(this, target);\n    }\n    cleanupPlaceholders(registration) {\n      var {target, registration} = this.resolveTarget(registration);\n      for (var i = 0; i < registration.placeholders.length; i++) {\n        this.cleanupPlaceholder(registration.placeholders[i], false);\n      }\n      registration.placeholders = [];\n    }\n    scrollSave() {\n      this.scrollSaveData = {\n        x: window.pageXOffset,\n        y: window.pageYOffset\n      };\n    }\n    scrollRestore() {\n      return;\n      window.scrollTo(this.scrollSaveData.x, this.scrollSaveData.y);\n    }\n\n    cleanupPlaceholder(placeholder, removeFromTarget) {\n      if (typeof removeFromTarget === 'undefined') {\n        removeFromTarget = true;\n      }\n\n      this.intersection.unobserve(placeholder);\n\n      this.scrollSave();\n      placeholder.remove();\n      this.scrollRestore();\n\n      this.phRegistry.delete(placeholder);\n      this.observed.delete(placeholder);\n      this.injecting.delete(placeholder);\n\n      if (removeFromTarget) {\n        var phres = this.resolveTarget(placeholder);\n        var { target, registration } = this.resolveTarget(phres.registration.target);\n        registration.placeholders= registration.placeholders.filter(ph=>ph != placeholder);\n      }\n    }\n    cleanupRegistrationTarget(registration) {\n      var {target, registration} = this.resolveTarget(registration);\n\n      this.cleanupPlaceholders(registration);\n\n      this.observed.delete(target);\n      this.injecting.delete(target);\n      this.intersection.unobserve(target); // this only necesarry when we didnt remove the item\n      if (this.options.enableOffloading) {\n        this.outersection.unobserve(target);\n      }\n      this.phRegistry.delete(target);\n      registration.extraData.listeners.forEach(l=>target.removeEventListener(l.type, l.listener));\n      for (var i = 0; i < registration.extraData.children.length; i++) {\n        var child = registration.extraData.children[i];\n        this.releaseTarget(child, targetRoot);\n      }\n      var self = this;\n      registration.elements.forEach(e=>{\n        self.scrollSave();\n        e.remove();\n        self.scrollRestore();\n      });\n    }\n\n    handleError(target, ex) {\n      var {target, registration} = this.resolveTarget(target);\n\n      // error event being triggered twice\n      if (!registration) { return; }\n\n      if (!(ex && ex.stack && ex.message))  {\n        if (!ex) {\n          ex = new Error(\"No error was provided on load\");\n        } else {\n          ex = new Error(ex);\n        }\n      }\n      let onLoadFailure = this.selectByDemandClass(\n          target, this.options.onLoadFailure,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          this.onLoadFailure);\n\n      if (registration.extraData.insertToLoad) {\n        this.scrollSave();\n        target.remove();\n        this.scrollRestore();\n        target.style.display = 'none';\n      }\n\n      onLoadFailure.call(this, target, ex);\n\n      // remove placeholders\n      this.cleanupPlaceholders(registration);\n\n      registration.loaded = true;\n      registration.extraData.endTime = performance.now();\n      this.recordPerformance(target, true);\n\n      let retryOnError = this.selectByDemandClass(\n          target, this.options.retryOnError,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          false);\n      let maxRetries = this.selectByDemandClass(\n          target, this.options.maxRetries,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          2);\n      if (retryOnError && registration.retryCount < maxRetries) {\n        registration.loading = false;\n        registration.loaded = false;\n        registration.retryCount+=1;\n        registration.retryDelay = 500 * Math.pow(2, registration.retryCount);\n        this.clearAttributes(target, registration.extraData);\n        var self = this;\n        setTimeout(function () {\n          self.beginLoad(target);\n        }, registration.retryDelay);\n      } else {\n        let onLoadComplete = this.selectByDemandClass(\n            target, this.options.onLoadComplete,\n            this.options.demandClassAttribute,\n            this.options.defaultDemandClass,\n            this.onLoadComplete);\n        onLoadComplete.call(this, target);\n      }\n    }\n    onLoadBegin(t) {\n      //  nothing to do here\n    }\n    onLoadSuccess(target) {\n      //  nothing to do here\n    }\n    onLoadComplete(target) {\n      //  nothing to do here\n    }\n    onLoadFailure(target, ex) {\n        var {target, registration} = this.resolveTarget(target);\n\n        var createFailureNode = this.selectByDemandClass(\n            target, this.options.createFailureNode,\n            this.options.demandClassAttribute,\n            this.options.defaultDemandClass,\n            this.createFailureNode);\n        var errorUI = createFailureNode.call(this, target, ex);\n        errorUI = Array.prototype.slice.call(errorUI);\n\n        var placeholders = registration.placeholders = registration.placeholders.concat(errorUI);\n\n        for (var i = 0; i < errorUI.length; i++) {\n          var eui = errorUI[i];\n          var errReg = this.registerPlaceholder(eui, target, placeholders, registration.extraData);\n          // register placeholders so if they contain media we dont try to demand load them...\n          errReg.loaded = true;\n\n          this.scrollSave();\n          target.parentNode.insertBefore(eui, target);\n          this.scrollRestore();\n        }\n        if (this.options.shouldRemove(target)) {\n          if (registration.extraData.insertToLoad) {\n            registration.expectRemove = true;\n            this.scrollSave();\n            target.remove();\n            this.scrollRestore();\n          } else {\n            target.style.display = 'none';\n          }\n        }\n    }\n    selectByDemandClass(t, data, attr, defaultKey, defaultData) {\n      if (!data) { return defaultData; }\n      if (typeof data === 'object') {\n        let key = defaultKey;\n        if (t.hasAttribute(attr)) { key = t.getAttribute(attr); }\n        do {\n          if (key in data) {\n            data = data[key];\n            break;\n          } else if (key === defaultKey) {\n            data = defaultData;\n            break;\n          }\n          key = defaultKey;\n        } while (true);\n      } \n\n      return data;\n    }\n    createFailureNode(t,ex) {\n      var ele = document.createElement('div');\n\n      let html = this.selectByDemandClass(t, \n          this.options.failureHtml, \n          this.options.demandClassAttribute, \n          this.options.defaultDemandClass, \n          this.defaultFailureHtml);\n      ele.innerHTML = html;\n\n      return ele.childNodes;\n    }\n    createLoadingNode(t) {\n      var ele = document.createElement('div');\n      \n      let html = this.selectByDemandClass(t, \n          this.options.loadingHtml, \n          this.options.demandClassAttribute, \n          this.options.defaultDemandClass, \n          this.defaultLoadingHtml);\n      ele.innerHTML = html;\n\n      return ele.childNodes;\n    }\n    registerPlaceholder(node, target, placeholders, extraData) {\n      var result = {\n        isRegistration: true,\n        target: target,\n        node: node,\n        placeholders: placeholders,\n        extraData: extraData,\n        loading: false,\n        elements: [],\n        loaded: false,\n        expectRemove: false,\n        retryCount: 0\n      };\n      this.phRegistry.set(node, result);\n      return result;\n    }\n    hasRegistration(target) {\n      // if we are passed a registration get the contained target\n      if (('isRegistration' in target) && target.isRegistration) {\n        target = target.node;\n      }\n\n      return this.phRegistry.has(target);\n    }\n    resolveTarget(target) {\n      var registration = target;\n      if (!('isRegistration' in target) || !(target.isRegistration)) {\n        registration = this.phRegistry.get(target);\n      } else { \n        target = registration.target;\n      }\n      return {\n        target: target,\n        registration: registration\n      };\n    }\n    restoreTarget(target) {\n      var {target, registration} = this.resolveTarget(target);\n      var extraData = registration.extraData;\n\n      let onLoadBegin = this.selectByDemandClass(\n          target, this.options.onLoadBegin,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          this.onLoadBegin);\n      onLoadBegin.call(this, target);\n\n      this._restoreTargetInternal(target, extraData);\n\n      if (!extraData.canLoad) {\n        this.processSuccess(registration);\n      }\n    }\n    _restoreTargetInternal(target, extraData) {\n      if (extraData.hasSrcset) {\n        target.setAttribute('srcset', extraData.srcset);\n      }\n      if (extraData.hasSizes) {\n        target.setAttribute('sizes', extraData.sizes);\n      }\n      if (extraData.hasSrc) {\n        target.setAttribute('src', this.predictUrl(target, extraData.src));\n      }\n      if (extraData.children.length > 0) {\n        for (var i = 0; i < extraData.children.length; i++) {\n          var childData = extraData.children[i];\n          this._restoreTargetInternal(childData.target, childData);\n        }\n      }\n\n      if (extraData.insertToLoad) {\n        target.style.display = 'none';\n        this.scrollSave();\n        document.body.appendChild(target);\n        this.scrollRestore();\n      }\n\n      extraData.startTime = performance.now();\n    }\n    clearAttributes(target, store) {\n      if (store.hasSrc) {\n        target.removeAttribute('src');\n      }\n      if (store.hasSrcset) {\n        target.removeAttribute('srcset');\n      }\n      if (store.hasSizes) {\n        target.removeAttribute('sizes');\n      }\n    }\n    captureTarget(target, targetRoot) {\n      var store = {\n        'target': target,\n        'hasSrc':  target.hasAttribute('src'),\n        'src':  target.getAttribute('src'),\n        'hasSrcset': target.hasAttribute('srcset'),\n        'srcset': target.getAttribute('srcset'),\n        'hasSizes': target.hasAttribute('sizes'),\n        'sizes': target.getAttribute('sizes'),\n        'isLink': ('tagName' in target) && (target.tagName.match(/link/i)),\n        'insertToLoad': ('tagName' in target) && (target.tagName.match(/iframe/i)),\n        'hasHref': target.hasAttribute('href'),\n        'href': target.getAttribute('href'),\n        'hasType': target.hasAttribute('type'),\n        'type': target.getAttribute('type'),\n        'hasDemandWidth': target.hasAttribute('data-demandjs-width'),\n        'demandWidth': target.getAttribute('data-demandjs-width'),\n        'hasDemandHeight': target.hasAttribute('data-demandjs-height'),\n        'demandHeight': target.getAttribute('data-demandjs-height'),\n        'hasDisplay': target.style && target.style.display,\n        'display': target.style.display || '',\n        'children': [],\n        'shouldRestore': false,\n        'canLoad': false,\n        'shouldInjectLink': false,\n        'listeners': [],\n        'performancePrediction': {}\n      };\n      // The assumption is that this is the only way these attribute can be defined, somebody could potentially set these attributes manually and this would violate that assumption\n      store.isOffloading = store.hasDemandWidth || store.hasDemandHeight;\n      this.clearAttributes(target, store);\n\n      if (store.isLink && store.hasHref) {\n        store.shouldInjectLink = true;\n        if (!store.hasType) {\n          store.type = 'text/html';\n        }\n      }\n\n\n      // We do not care about load events of child elements\n      if ((store.hasSrc || store.hasSrcset) && target === targetRoot) {\n        store.shouldRestore = true;\n        store.canLoad = true;\n     \n        let listeners = [];\n        if(  ('tagName' in target) && target.tagName.match(/video|audio/i)) {\n           listeners.push({\n             type:'loadedmetadata', \n             listener:evt=>this.processSuccess(targetRoot)\n           });\n           listeners.push({\n             type:'loadeddata', \n             listener:evt=>this.processSuccess(targetRoot)\n           });\n         } else {\n           listeners.push({\n             type:'load', \n             listener:evt=>this.processSuccess(targetRoot)\n           });\n         }\n\n        if (store.hasSrcset && store.hasSrc) {\n          listeners.push({\n            type:'error', \n            listener:evt=>{\n              this.handleError(targetRoot, new Error('Loading for srcset and src failed (' + store.srcset + ')(' + store.src + ')'));\n            }\n          });\n        } else if (store.hasSrcset) {\n          listeners.push({\n            type:'error', \n            listener:evt=>{\n              this.handleError(targetRoot, new Error('Loading for srcset failed (' + store.srcset + ')'))\n            }\n          });\n        } else if (store.hasSrc) {\n          listeners.push({\n            type:'error', \n            listener:evt=>{\n              this.handleError(targetRoot, new Error('Loading for src failed (' + store.src + ')'))\n            }\n          });\n        } else {\n          listeners.push({\n            type:'error', \n            listener:evt=>{\n              this.handleError(targetRoot, new Error('Loading srced element failed (FALLBACK ERROR MSG)'))\n            }\n          });\n        }\n\n        listeners.forEach(l=>target.addEventListener(l.type, l.listener));\n        store.listeners = listeners;\n      }\n\n      if ('tagName' in target && target.tagName.match(/picture|video|audio/i)) {\n        if (target === targetRoot) {\n          store.shouldRestore = true;\n        }\n        for (var i = 0; i < target.children.length; i++) {\n          var child = target.children[i];\n          var desc = this.captureTarget(child, targetRoot);\n          desc.index = i;\n          store.children.push(desc);\n        }\n      }\n\n      return store;\n    }\n    getPerformanceRecord(url) {\n      if (!(url in this.options.urlPerformance)) {\n        this.options.urlPerformance[url] = {\n          predictedSpeed: 0,\n          bitsPerMillisecond: [],\n          currentUsage: 0\n        };\n      }\n      return this.options.urlPerformance[url];\n    }\n    getPerformanceSize(url, target) {\n      var entries = performance.getEntriesByName(url);\n      for (var i = 0 ; i < entries.length; i++) {\n        var entry = entries[i];\n        if (entry.transferSize) { return entry.transferSize; }\n      }\n\n      return this._defaultFileSize(target);\n    }\n    _defaultFileSize(target) {\n      return this.selectByDemandClass(\n          target, this.options.defaultFileSize,\n          this.options.demandClassAttribute,\n          this.options.defaultDemandClass,\n          512 * 1024);\n    }\n    _defaultPerfSpeed(target) {\n      return this._defaultFileSize(target) / 1000;\n    }\n    _getFailureMultiplier() {\n      return 100000;\n    }\n    _recordPerformance(target, url, bitsPerMillisecond, prediction) {\n      var arr = this.getPerformanceRecord(url);\n\n      arr.bitsPerMillisecond.push(bitsPerMillisecond);\n\n      var avg = 0;       \n      for (var i = 0; i < arr.bitsPerMillisecond.length; i++) {\n        avg += arr.bitsPerMillisecond[i];\n      }\n      avg /= arr.bitsPerMillisecond.length;\n      while (arr.bitsPerMillisecond.length > this.options.maxPerformanceRecords) {\n        arr.bitsPerMillisecond.shift();\n      }\n      arr.predictedSpeed = avg;\n      arr.currentUsage -= prediction;\n    }\n    recordPerformance(target, failure) {\n      var {registration, target} = this.resolveTarget(target);\n      var ed = registration.extraData;\n\n      var duration = ed.endTime - ed.startTime;\n      if (failure) {\n        duration *= this._getFailureMultiplier();\n      }\n      if (ed.hasSrc) {\n        var url = ed.src;\n        var perf = duration / this.getPerformanceSize(url);\n        var prediction = registration.extraData.performancePrediction;\n        this._recordPerformance(target, prediction.prefix, perf, prediction.speed);\n      }\n      if (ed.hasHref) {\n        var url = ed.href;\n        var perf = duration / this.getPerformanceSize(url);\n        var prediction = registration.extraData.performancePrediction;\n        this._recordPerformance(target, prediction.prefix, perf, prediction.speed);\n      }\n    }\n    predictUrl(target, url) {\n      var {registration, target} = this.resolveTarget(target);\n\n      var { suffix, alternatives } = this.getAlternatives(url);\n      var bestSpeed = this._defaultPerfSpeed(target), bestUsage = null, bestUrl = url;\n      for (var i = 0; i < alternatives.length; i++) {\n        var altUrl = alternatives[i];\n        var perf = this.getPerformanceRecord(altUrl);\n        var prediction = perf.currentUsage + perf.predictedSpeed;\n        if (bestUsage === null || prediction < bestUsage) {\n          bestUsage = prediction;\n          bestSpeed = perf.predictedSpeed;\n          bestUrl = altUrl;\n        }\n      }\n      \n      this.getPerformanceRecord(bestUrl).currentUsage += bestSpeed;\n      registration.extraData.performancePrediction = {\n        prefix: bestUrl,\n        speed: bestSpeed\n      };\n\n\n      return bestUrl + suffix;\n    }\n    getAlternatives(url) {\n      if (!(typeof url === 'string')) { throw 'Expected url but got ' + (typeof url); }\n\n      for (var i = 0; i < this.options.alternatives.length; i++) {\n        var altSet = this.options.alternatives[i];\n        if (Array.isArray(altSet)) {\n          for (var j = 0; j < altSet.length; j++) {\n            var item = altSet[j];\n            if (typeof item === 'string') { \n              if (url.startsWith(item)) {\n                return { \n                  suffix: url.substring(item.length),\n                  alternatives: altSet\n                }\n              }\n            }\n          }\n        }\n      }\n\n      var idx = 0, cnt = 0, bestUrl = url, suffix='';\n      while (idx >= 0 && cnt < 3) {\n        cnt++;\n        idx = url.indexOf('/', idx+1);\n      }\n      if (idx >= 0) {\n        bestUrl = url.substring(0, idx);\n        suffix = url.substring(idx);\n      }\n      return {\n        suffix: suffix,\n        alternatives: [bestUrl]\n      };\n    }\n    isContextExcluded(target) {\n      if (!target) { return false; }\n      if (!('parentNode' in target)) { return false; }\n      var parent = target.parentNode;\n      if (!parent) { return false; }\n      if (!('tagName' in parent)) { return false; }\n      if (parent.tagName.match(/picture|video|audio/i)) { return true; }\n\n      // need to recurse up for cases like video with embedded html as a fallback\n      return this.isContextExcluded(parent);\n    }\n    observeTarget(target, oldRegistration) {\n      if (this.isResourceLoaded(target)) {\n        // do nothing, its already fully loaded\n      } else if (this.isContextExcluded(target)) { \n        // do nothing, another element should take care of it\n      } else {\n        var store = this.captureTarget(target, target);\n\n        var createLoadingNode = this.selectByDemandClass(\n            target, this.options.createLoadingNode,\n            this.options.demandClassAttribute,\n            this.options.defaultDemandClass,\n            this.createLoadingNode);\n        var placeholders = createLoadingNode.call(this, target, store);\n        placeholders = Array.prototype.slice.call(placeholders);\n\n        for (var i = 0; i < placeholders.length; i++) {\n          var placeholder = placeholders[i];\n\n          var placeReg = this.registerPlaceholder(placeholder, target, placeholders, store);\n          // register placeholders so if they contain media we dont try to demand load them...\n          placeReg.loaded = true;\n\n          this.scrollSave();\n          target.insertAdjacentElement('beforeBegin', placeholder);\n          this.scrollRestore();\n\n          this.intersection.observe(placeholder);\n        }\n        var registration = this.registerPlaceholder(target, target, placeholders, store);\n        this.attributeMutations.observe(target, this.attributeMutationOptions);\n        if (this.options.shouldRemove(target)) {\n          if (store.insertToLoad) {\n            registration.expectRemove = true;\n            this.scrollSave();\n            target.remove();\n            this.scrollRestore();\n          } else {\n            target.style.display = 'none';\n          }\n        } else {\n          this.intersection.observe(target);\n        }\n      }\n    }\n    observeTargets(targets) {\n      for (var i = 0; i < targets.length; i++) {\n        var target = targets[i];\n        this.observeTarget(target);\n      }\n    }\n    isLoadedRecursive(target, injecting) {\n      var { target, registration } = this.resolveTarget(target);\n      if (typeof registration !== 'undefined' && registration && registration.loaded) { return { loaded: true, injecting: injecting || this.injecting.get(target) }; }\n      // we cant be injecting an element and loading it simultaneously\n      if (!injecting && target.parentNode) {\n       return this.isLoadedRecursive(target.parentNode, injecting || this.injecting.get(target));\n      }\n     return { loaded: false, injecting: injecting || this.injecting.get(target) };\n    }\n    isScript(bc) {\n      return !!('tagName' in bc && bc.tagName.match(/^script$/i));\n    }\n    isTargetMatch(target) {\n      var isMatch = 'matches' in target && target.matches(this.options.selector);\n      isMatch = isMatch && !(this.options.ignoreSelector && target.matches(this.options.ignoreSelector));\n\n      var isScript = this.isScript(target);\n\n      if (!isMatch && !isScript) {\n        return { isMatch: isMatch, isScript: isScript, loaded: false, injecting: false }; \n      }\n     \n      var result = this.isLoadedRecursive(target, false);\n      result.isMatch = isMatch;\n      result.isScript = isScript;\n      return result;\n    }\n    queryTargets() {\n      let result = [];\n      var nodes = document.querySelectorAll(this.options.selector);\n      for (var i = 0; i < nodes.length; i++) {\n        var node = nodes[i];\n        if (this.options.ignoreSelector && 'matches' in node && node.matches(this.options.ignoreSelector)) { continue; }\n        result.push(node);\n      }\n      return result;\n    }\n    shouldRemove(t) {\n      return !('tagName' in t) || !(t.tagName.match(/link/i)); \n    }\n    constructor(options) {\n      this.phRegistry = new WeakMap();\n      this.injecting = new WeakMap();\n      this.observed = new WeakMap();\n\n      let newHandlers = {};\n      if (options && 'linkHandler' in options) {\n        newHandlers = options.linkHandler;\n        delete options.linkHandler;\n      }\n\n      this.defaultLoadingHtml = '<div style=\"width:100%;height:100%\">Loading In Progress</div>';\n      this.defaultFailureHtml = '<div style=\"background-color:#F00;color:#FFF;font-size:20pt;\">ERROR</div>';\n\n      this.options = Object.assign({\n        previewLoading: false,\n        previewFailure: false,\n        demandClassAttribute: 'data-demand',\n        defaultDemandClass: 'default',\n        loadingHtml: this.defaultLoadingHtml,\n        failureHtml: this.defaultFailureHtml,\n        createLoadingNode: t=>this.createLoadingNode(t),\n        createFailureNode: (t,ex)=>this.createFailureNode(t, ex),\n        shouldRemove: t=>!('tagName' in t) || !(t.tagName.match(/link/i)),\n        shouldInsertOnLoad: t=>this.options.shouldRemove(t),\n        selector: 'img,video,picture,iframe,link.demand',\n        ignoreSelector: '.nodemand',\n        rootMargin: '256px',\n        threshold: 0.001,\n        rootMarginOuter: '2048px',\n        thresholdOuter: 0.001,\n        enableOffloading: false,\n        onLoadBegin: t=>this.onLoadBegin(t),\n        onLoadSuccess: t=>this.onLoadSuccess(t),\n        onLoadFailure: (t,e)=>this.onLoadFailure(t,e),\n        onLoadComplete: t=>this.onLoadComplete(t),\n        alternatives: [],\n        urlPerformance: {},\n        defaultFileSize: 1024 * 512, // 512KB\n        maxPerformanceRecords: 7,\n        retryOnError: true,\n        maxRetries: 2,\n        emptyImageUrl: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\n\n        linkHandler: {\n          'text/html': (t,c)=>this.injectHtml(t,c),\n          'application/xhtml+xml': (t,c)=>this.injectHtml(t,c)\n        }\n      }, options);\n      this.options.linkHandler = Object.assign(this.options.linkHandler, newHandlers);\n\n      this.mutation = new MutationObserver((a,b)=>this.observeMutation(a,b));\n      this.mutationOptions = {\n        childList: true,\n        subtree: true\n      };\n\n      this.intersectionOptions = {\n        root: null,\n        rootMargin:this.options.rootMargin,\n        threshold:this.options.threshold \n      };\n      this.intersection = new IntersectionObserver( (a,b)=>this.observeIntersection(a,b), this.intersectionOptions);\n\n      if (this.options.enableOffloading) {\n        this.outersectionOptions = {\n          root: null,\n          rootMargin:this.options.rootMarginOuter,\n          threshold:this.options.thresholdOuter \n        };\n        this.outersection = new IntersectionObserver( (a,b)=>this.observeOutersection(a,b), this.outersectionOptions);\n      }\n\n      this.attributeMutations = new MutationObserver((a,b)=>this.observeAttributeMutation(a,b));\n      this.attributeMutationOptions = { \n        attributes: true, \n        attributeFilter: ['src', 'href', 'srcset', 'sizes', 'type'],\n        attributeOldValue: false\n      };\n\n  \n      var targets = this.queryTargets();\n      this.observeTargets(targets);\n      this.mutation.observe(document.body, this.mutationOptions);\n    }\n  }\n\n  ctx['DemandJS'] = DemandJS;\n})(window);\n/** @license MIT License\n\nCopyright (c) 2017 Sean Hanna\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n */\n"]}